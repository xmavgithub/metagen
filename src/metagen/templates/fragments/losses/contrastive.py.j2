# Contrastive loss fragment (CLIP-style).
import torch
import torch.nn.functional as F


def contrastive_loss(image_emb: torch.Tensor, text_emb: torch.Tensor, temperature: float = 0.07):
    logits = image_emb @ text_emb.T
    logits = logits / temperature
    targets = torch.arange(image_emb.size(0), device=image_emb.device)
    loss_i = F.cross_entropy(logits, targets)
    loss_t = F.cross_entropy(logits.T, targets)
    return (loss_i + loss_t) * 0.5
